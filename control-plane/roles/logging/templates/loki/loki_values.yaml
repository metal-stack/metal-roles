image:
  repository: grafana/loki
  tag: {{ logging_loki_image_version }}

affinity:
 podAntiAffinity:
   requiredDuringSchedulingIgnoredDuringExecution:
   - labelSelector:
       matchExpressions:
       - key: instance
         operator: In
         values:
         - etcd-main
     namespaces:
     - all
     topologyKey: "kubernetes.io/hostname"

config:
  limits_config:
    ingestion_rate_mb: 32
    ingestion_burst_size_mb: 64
    per_stream_rate_limit: "16MB"
    per_stream_rate_limit_burst: "32MB"

  schema_config:
    configs: {{ logging_schema_configs | to_json }}
  server:
    grpc_server_max_send_msg_size: 12582912
    grpc_server_max_recv_msg_size: 12582912
  storage_config:
   boltdb_shipper:
     active_index_directory: /data/loki/index
     cache_location: /data/loki/index_cache
     cache_ttl: 24h
     resync_interval: 5s


  ruler:
    storage:
      type: local
      local:
        directory: /rules
    rule_path: /tmp/scratch
    alertmanager_url: http://alertmanager-operated:9093


persistence:
  enabled: true
  size: {{ logging_loki_size }}

serviceMonitor:
  enabled: true
  additionalLabels:
    release: {{ environment_name }}
  annotations: {}

# extraVolumes:
#  - name: loki-gcs
#    secret:
#      secretName: loki-gcs

# extraVolumeMounts:
#   - name: loki-gcs
#     mountPath: "/etc/secrets/loki/"
#     readOnly: true

# env:
#   - name: GOOGLE_APPLICATION_CREDENTIALS
#     value: /etc/secrets/loki/gcs.json

livenessProbe:
  httpGet:
    path: /ready
    port: http-metrics
  initialDelaySeconds: 45
  failureThreshold: 30
  periodSeconds: 100
