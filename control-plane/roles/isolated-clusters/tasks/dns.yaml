- name: Create namespace {{ isolated_clusters_dns_namespace }}
  k8s:
    definition:
      api_version: v1
      kind: Namespace
      metadata:
        name: "{{ isolated_clusters_dns_namespace }}"
        labels:
          app.kubernetes.io/part-of: "{{ isolated_clusters_group_label }}"
    kubeconfig: {{ isolated_clusters_virtual_garden_kubeconfig | shoot_admin_kubeconfig(shoot.project_namespace, shoot_name) }}

- name: Deploy DNS service
  k8s:
    kubeconfig: "/tmp/kubeconfig.{{ cluster }}"
    template:
    - path: dns/coredns-configmap.yaml
    - path: dns/coredns-deployment.yaml
    - path: dns/coredns-service.yaml
