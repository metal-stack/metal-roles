apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    release: prometheus
  name: keycloak-servicemonitor
  namespace: monitoring
spec:
  endpoints:
  - port: web
    honorLabels: true
    path: /federate
    params:
      match[]:
      - '{job!="kube-kubelet-seed",job!="kube-etcd3",job!="kubelet",job!="kube-state-metrics",job!="cadvisor",job=~"..*"}'
    path: /federate
    port: web
  # in shoot namespace
  - honorLabels: true
    path: /federate
    port: metrics
    params:
      match[]:
      - '{job!="kube-kubelet-seed",job!="kube-etcd3",job!="kubelet",type!="seed",job!="blackbox-apiserver",job!="vpn-connection",job=~"..*"}'
      - '{job="blackbox-apiserver"}'
      - '{job="tunnel-probe-apiserver-proxy"}'
  namespaceSelector:
    any: true
  selector:
    matchLabels:
      app: prometheus
      role: monitoring
