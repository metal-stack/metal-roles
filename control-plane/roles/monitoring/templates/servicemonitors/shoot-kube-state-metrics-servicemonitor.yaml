apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    release: prometheus
  name: shoot-kube-state-metrics
  namespace: monitoring
spec:
  endpoints:
  - honorLabels: true
    port: metrics
  jobLabel: component
  namespaceSelector:
    any: true
  selector:
    matchLabels:
      component: kube-state-metrics
      type: shoot
  relabel_configs:
  - source_labels: [__meta_kubernetes_service_label_component]
    separator: ;
    regex: kube-state-metrics
    replacement: $1
    action: keep
  - source_labels: [__meta_kubernetes_service_port_name]
    separator: ;
    regex: (.*)
    replacement: $1
    action: keep
  - source_labels: [__meta_kubernetes_service_label_type]
    separator: ;
    regex: (.+)
    target_label: type
    replacement: ${1}
    action: replace
  - separator: ;
    regex: (.*)
    target_label: instance
    replacement: kube-state-metrics
    action: replace
