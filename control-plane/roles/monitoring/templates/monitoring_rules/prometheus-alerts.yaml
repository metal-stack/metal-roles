{% raw %}
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    release: kube-prometheus-stack
    role: alert-rules
  name: example-rule
spec:
  groups:
  - name: example-rule
    rules:

  # Alert for any instance that is unreachable for >1 minutes.
    - alert: InstanceDown
      expr: up == 0
      for: 1m
      labels:
        severity: page
      annotations:
        summary: "Instance {{ $labels.instance }} down"
        description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minutes."

    - alert: HostOutOfMemory
      expr: node_memory_MemAvailable / node_memory_MemTotal * 100 < 25
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Host out of memory (instance {{ $labels.instance }})"
        description: "Node memory is filling up (< 25% left)\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"

    - alert: HostOutOfDiskSpace
      expr: (node_filesystem_avail{mountpoint="/"}  * 100) / node_filesystem_size{mountpoint="/"} < 50
      for: 1s
      labels:
        severity: warning
      annotations:
        summary: "Host out of disk space (instance {{ $labels.instance }})"
        description: "Disk is almost full (< 50% left)\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"

    - alert: HostHighCpuLoad
      expr: (sum by (instance) (irate(node_cpu{job="node_exporter_metrics",mode="idle"}[5m]))) > 80
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Host high CPU load (instance {{ $labels.instance }})"
        description: "CPU load is > 80%\n  VALUE = {{ $value }}\n  LABELS: {{ $labels }}"

    - alert: PodNotReady
      expr: kube_pod_status_phase{namespace="monitoring", phase!="Running"} == 1
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "Pod {{ $labels.pod }} in namespace {{ $labels.namespace }} is not ready"
        description: "The pod {{ $labels.pod }} in namespace {{ $labels.namespace }} has been in a non-running state for more than 1 minute."

    - alert: PodRestartCount
      expr: rate(kube_pod_container_status_restarts_total[1m]) > 0.1
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Pod {{ $labels.pod }} restarted too frequently"
        description: "The pod {{ $labels.pod }} has been restarted {{ $value }} times in the last 5 minutes."

    - alert: HighCpuUsage
      expr: sum(rate(container_cpu_usage_seconds_total{container_name!="POD",container_name!="",namespace="<your_namespace>"}[5m])) BY (pod_name) / sum(kube_pod_container_resource_limits_cpu_cores{namespace="<your_namespace>"}) BY (pod_name) * 100 > 90
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High CPU usage in pod {{ $labels.pod }}"
        description: "The pod {{ $labels.pod }} has a CPU usage of {{ $value }}%."

    - alert: HighMemoryUsage
      expr: sum(container_memory_usage_bytes{container_name!="POD",container_name!="",namespace="<your_namespace>"}) BY (pod_name) / sum(kube_pod_container_resource_limits_memory_bytes{namespace="<your_namespace>"}) BY (pod_name) * 100 > 80
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High memory usage in pod {{ $labels.pod }}"
        description: "The pod {{ $labels.pod }} has a memory usage of {{ $value }}%."

    - alert: NodeDiskSpace
      expr: (node_filesystem_avail_bytes{mountpoint="/"}/node_filesystem_size_bytes{mountpoint="/"}) * 100 < 10
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "Low disk space on node {{ $labels.node }}"
        description: "The node {{ $labels.node }} has less than 10% disk space available."

    - alert: DeploymentReplicasMismatch
      expr: kube_deployment_status_replicas_available{namespace="monitoring"} != kube_deployment_spec_replicas{namespace="monitoring"}
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "Deployment replicas mismatch in monitoring namespace"
        description: "The number of available replicas for a deployment in the monitoring namespace does not match the desired number of replicas."

    - alert: IngressNotAlive
      expr: count(kube_ingress_labels{namespace="monitoring"}) != 2
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: "Ingresses are not alive in monitoring namespace"
        description: "One or more ingresses in the monitoring namespace are not alive."

{% endraw %}
