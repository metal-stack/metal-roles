{
  "ztp": {
    "02-user": {
      "plugin": {
        "url": "http://{{ ztp_listen_address }}:{{ ztp_port }}/ztp.sh"
      }
    },
    "03-download": {
      "files": [
        {
          "url": {
            "source": "http://{{ ztp_listen_address }}:{{ ztp_port }}/resolv.conf",
            "destination": "/etc/resolv.conf"
          }
        },
        {
          "url": {
            "source": "http://{{ ztp_listen_address }}:{{ ztp_port }}/iptables.json",
            "destination": "/etc/sonic/iptables.json"
          }
        }
      ]
    },
    "04-configdb-json": {
      "dynamic-url": {
        "source": {
          "prefix": "http://{{ ztp_listen_address }}:{{ ztp_port }}/",
          "identifier": "hostname",
          "suffix": "_config_db.json"
        }
      },
      "clear-config": true
    },
{% if ztp_additional_files | selectattr('name', 'equalto', 'ztp-provisioning-script.sh') %}
    "05-provisioning-script": {
      "plugin": {
        "url": "http://{{ ztp_listen_address }}:{{ ztp_port }}/ztp-provisioning-script.sh"
      },
      "shell": true,
      "reboot-on-success": true
    },
{% endif %}
    "restart-ztp-no-config": false
  }
}
