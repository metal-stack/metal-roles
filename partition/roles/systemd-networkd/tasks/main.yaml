---
- name: Enable systemd-networkd
  systemd:
    name: systemd-networkd
    enabled: yes
    state: started

- name: Render systemd-networkd lo config
  template:
    src: lo.network.j2
    dest: /etc/systemd/network/00-lo.network
  notify: restart systemd-networkd

- name: Render systemd-networkd link config
  template:
    src: link.j2
    dest: "/etc/systemd/network/{{ (i+1)*10 }}-{{ item.name }}.link"
  notify: restart systemd-networkd
  loop: "{{ nics }}"
  loop_control:
    index_var: i

- name: Render systemd-networkd network config
  template:
    src: network.j2
    dest: "/etc/systemd/network/{{ (i+1)*10 }}-{{ item.name }}.network"
  notify: restart systemd-networkd
  loop: "{{ nics }}"
  loop_control:
    index_var: i
